require(tidyverse)
# For the SEER database, we talked about combining the 
# AJCC stage columnsâ€¦ each row should only have data in 
# one of these columns, but if there are instances were 
# more than one value is present, the newest one is the 
# best.  In the recoded excel sheet this is column AC, AN, 
# AR. 
# We also talked about the number of primaries and the 
# sequence number ie 1st of 3 primaries = 3 primary cancers, 
# other two diagnosed after liposarcoma etc.  This is 
# currently in column G. If it is easier to look at the 
# total numbers of malignant tumors separately, this is 
# in column DZ.
# Derived AJCC Stage Group, 7th ed (2010-2015)
# Derived AJCC Stage Group, 6th ed (2004-2015)
# AJCC stage 3rd edition (1988-2003)
require(tidyverse)

vars=c('Derived.AJCC.M..7th.ed..2010.2015.',
       'Derived.AJCC.M..6th.ed..2004.2015.',
       'AJCC.stage.3rd.edition..1988.2003.')

SEER_data=read.csv('SEER_data_recoded3 (1).csv')

SEER_data_AJCC_aggregate=SEER_data%>%
  mutate(AJCC_aggregate=SEER_data%>%select(vars)%>%
           mutate(across(everything(),
                ~replace(.,.=='Blank(s)',NA)))%>%
           apply(1,function(x) x[which(!is.na(x))[1]]))
table(SEER_data_AJCC_aggregate$AJCC_aggregate)
write.csv(SEER_data_AJCC_aggregate,
          file='SEER_data_AJCC_aggregate.csv')

SEER_data_AJCC_aggregate=SEER_data_AJCC_aggregate%>%
  mutate(tumor_type=Site.recode.ICD.O.3.WHO.2008)
table(SEER_data_AJCC_aggregate$tumor_type)
